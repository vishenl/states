{% comment %} Main Product Section - Combines gallery and info {% endcomment %}
<div class="breadcrumb">
  <div class="breadcrumb-inner mv-container">
    <a href="{{ routes.root_url }}">Home</a> / 
    <a href="{{ routes.collections_url }}">Products</a> / 
    <strong>{{ product.title }}</strong>
  </div>
</div>

<section class="product-hero" style="--product-color: {{ product.metafields.custom.product_color | default: '#7a12d4' }};">
  <div class="product-hero-inner mv-container">
    {% comment %} Product Gallery {% endcomment %}
    <div class="product-gallery">
      <div class="main-image" id="main-image">
        {% if product.featured_image %}
          <img 
            src="{{ product.featured_image | image_url: width: 800 }}" 
            alt="{{ product.featured_image.alt | default: product.title }}"
            id="gallery-main-img"
            loading="eager"
          >
        {% else %}
          {{ 'product-1' | placeholder_svg_tag }}
        {% endif %}
      </div>
      
      {% if product.images.size > 1 %}
        <div class="thumbnail-row">
          {% for image in product.images limit: 4 %}
            <div 
              class="thumbnail{% if forloop.first %} active{% endif %}" 
              data-image-url="{{ image | image_url: width: 800 }}"
            >
              <img 
                src="{{ image | image_url: width: 150 }}" 
                alt="{{ image.alt | default: product.title }}"
                loading="lazy"
              >
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    {% comment %} Product Info {% endcomment %}
    <div class="product-info">
      {% comment %} Product Badge {% endcomment %}
      {% if product.metafields.custom.badge_text %}
        <div class="product-badge">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 2a8 8 0 100 16 8 8 0 000-16zm1 11H9v-2h2v2zm0-4H9V5h2v4z"/>
          </svg>
          {{ product.metafields.custom.badge_text }}
        </div>
      {% endif %}

      <h1 class="product-title">{{ product.title }}</h1>
      
      {% if product.metafields.custom.tagline %}
        <p class="product-tagline">{{ product.metafields.custom.tagline }}</p>
      {% elsif product.description != blank %}
        <p class="product-tagline">{{ product.description | strip_html | truncate: 150 }}</p>
      {% endif %}

      {% comment %} Rating {% endcomment %}
      <div class="product-rating">
        <span class="stars">★★★★★</span>
        <span class="rating-text">
          {{ product.metafields.reviews.rating.value | default: '4.8' }}/5 based on 
          <a href="#testimonials">{{ product.metafields.reviews.rating_count | default: '100' }} reviews</a>
        </span>
      </div>

      {% comment %} Clinical Highlights {% endcomment %}
      {% if section.settings.show_clinical_highlights %}
        <div class="clinical-highlights">
          <h4>{{ section.settings.clinical_title }}</h4>
          <div class="clinical-stats">
            {% for block in section.blocks %}
              {% if block.type == 'clinical_stat' %}
                <div class="clinical-stat">
                  <div class="clinical-stat-value">{{ block.settings.value }}</div>
                  <div class="clinical-stat-label">{{ block.settings.label }}</div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endif %}

      {% comment %} Pricing Section {% endcomment %}
      <div class="pricing-section">
        {% form 'product', product %}
          {% comment %} Variant selector if multiple variants {% endcomment %}
          {% if product.variants.size > 1 %}
            <div class="variant-selector">
              {% for option in product.options_with_values %}
                <div class="variant-option">
                  <label for="option-{{ option.name | handleize }}">{{ option.name }}</label>
                  <select name="id" id="option-{{ option.name | handleize }}">
                    {% for value in option.values %}
                      <option value="{{ product.variants[forloop.index0].id }}">{{ value }}</option>
                    {% endfor %}
                  </select>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          {% endif %}

          {% comment %} Selling Plans (Subscriptions) {% endcomment %}
          {% if product.selling_plan_groups.size > 0 %}
            <div class="pricing-options">
              {% for selling_plan_group in product.selling_plan_groups %}
                {% for selling_plan in selling_plan_group.selling_plans %}
                  <div class="pricing-option" data-selling-plan-id="{{ selling_plan.id }}">
                    <div class="pricing-radio"></div>
                    <div class="pricing-details">
                      <div class="pricing-label">
                        {{ selling_plan.name }}
                        {% if selling_plan.price_adjustments[0].value > 0 %}
                          <span class="save-badge">SAVE {{ selling_plan.price_adjustments[0].value }}%</span>
                        {% endif %}
                      </div>
                      <div class="pricing-desc">Delivered monthly. Cancel anytime.</div>
                    </div>
                    <div class="pricing-amount">
                      {{ product.selected_or_first_available_variant.price | times: 80 | divided_by: 100 | money }}<span>/mo</span>
                    </div>
                  </div>
                {% endfor %}
              {% endfor %}
              
              <div class="pricing-option selected" data-selling-plan-id="">
                <div class="pricing-radio"></div>
                <div class="pricing-details">
                  <div class="pricing-label">One-Time Purchase</div>
                  <div class="pricing-desc">{{ product.metafields.custom.supply_duration | default: '30-day supply (30 servings)' }}</div>
                </div>
                <div class="pricing-amount">{{ product.selected_or_first_available_variant.price | money }}</div>
              </div>
            </div>
            <input type="hidden" name="selling_plan" id="selling-plan-input" value="">
          {% else %}
            <div class="pricing-simple">
              <div class="price-current">{{ product.selected_or_first_available_variant.price | money }}</div>
              {% if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price %}
                <div class="price-compare">{{ product.selected_or_first_available_variant.compare_at_price | money }}</div>
              {% endif %}
            </div>
          {% endif %}

          {% comment %} Quantity & Add to Cart {% endcomment %}
          <div class="purchase-row">
            <div class="qty-selector">
              <button type="button" class="qty-btn" data-action="decrease">-</button>
              <input type="number" name="quantity" class="qty-value" value="1" min="1" max="10">
              <button type="button" class="qty-btn" data-action="increase">+</button>
            </div>
            
            <button type="submit" class="add-to-cart" {% unless product.available %}disabled{% endunless %}>
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
              </svg>
              {% if product.available %}
                Add to Cart - <span class="add-to-cart-price">{{ product.selected_or_first_available_variant.price | money }}</span>
              {% else %}
                Sold Out
              {% endif %}
            </button>
          </div>
        {% endform %}

        {% comment %} Trust Badges {% endcomment %}
        <div class="trust-badges">
          {% for block in section.blocks %}
            {% if block.type == 'trust_badge' %}
              <div class="trust-badge">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                </svg>
                {{ block.settings.text }}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

{% comment %} Mobile Sticky CTA {% endcomment %}
<div class="mobile-sticky">
  <div class="mobile-sticky-info">
    <div class="mobile-sticky-name">{{ product.title }}</div>
    <div class="mobile-sticky-price">{{ product.selected_or_first_available_variant.price | money }}</div>
  </div>
  <button class="mobile-sticky-btn" id="mobile-add-to-cart">Add to Cart</button>
</div>

{% schema %}
{
  "name": "Main Product",
  "tag": "div",
  "class": "main-product-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_clinical_highlights",
      "label": "Show clinical highlights",
      "default": true
    },
    {
      "type": "text",
      "id": "clinical_title",
      "label": "Clinical section title",
      "default": "Clinically Validated Results"
    }
  ],
  "blocks": [
    {
      "type": "clinical_stat",
      "name": "Clinical Stat",
      "settings": [
        {
          "type": "text",
          "id": "value",
          "label": "Stat value",
          "default": "6"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Stat label",
          "default": "Patented ingredients"
        }
      ]
    },
    {
      "type": "trust_badge",
      "name": "Trust Badge",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Badge text",
          "default": "60-Day Money Back"
        }
      ]
    }
  ]
}
{% endschema %}

